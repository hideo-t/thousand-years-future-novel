<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>千年後の未来への旅: 時空の旅人たち</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Zen+Kaku+Gothic+New:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: #1a1a2e;
      --text-primary: #e0ddd5;
      --text-secondary: #8a8a9a;
      --accent: #4a9eff;
      --accent-dim: #2a5a9a;
      --gold: #c4a35a;
      --chapter-border: #2a2a3e;
      --serif: 'Noto Serif JP', 'Hiragino Mincho ProN', serif;
      --sans: 'Zen Kaku Gothic New', 'Hiragino Kaku Gothic ProN', sans-serif;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: var(--serif);
      font-size: 17px;
      line-height: 1.95;
      min-height: 100vh;
    }

    /* ─── Header ─── */
    .hero {
      position: relative;
      text-align: center;
      padding: 100px 20px 80px;
      background: linear-gradient(180deg, #1a2a4a 0%, #0f1a2f 100%);
      overflow: hidden;
    }
    .hero::before {
      content: '';
      position: absolute; inset: 0;
      background: radial-gradient(ellipse at 50% 30%, rgba(120,180,255,0.15) 0%, transparent 70%);
    }
    .hero-title {
      font-family: var(--serif);
      font-size: clamp(1.8rem, 5vw, 3.2rem);
      font-weight: 700;
      letter-spacing: 0.08em;
      color: #ffffff;
      text-shadow: 0 2px 20px rgba(100,160,255,0.3);
      margin-bottom: 12px;
      position: relative;
    }
    .hero-sub {
      font-family: var(--sans);
      font-size: 0.9rem;
      color: #b0c4de;
      letter-spacing: 0.15em;
    }
    .hero-line {
      width: 60px; height: 1px;
      background: var(--gold);
      margin: 28px auto 0;
    }

    /* ─── Digest Carousel ─── */
    .carousel-wrap {
      background: linear-gradient(180deg, #0f1a2f 0%, #0a0e18 100%);
      padding: 24px 0 20px;
      overflow: hidden;
    }
    .carousel-track {
      display: flex;
      gap: 14px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      padding: 0 calc((100vw - min(85vw, 600px)) / 2);
      scrollbar-width: none;
    }
    .carousel-track::-webkit-scrollbar { display: none; }
    .carousel-slide {
      flex: 0 0 min(85vw, 280px);
      scroll-snap-align: center;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      text-decoration: none;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      transition: transform 0.2s;
      aspect-ratio: 3/2;
    }
    .carousel-slide:active { transform: scale(0.97); }
    .carousel-slide img {
      width: 100%; height: 100%;
      object-fit: cover;
      display: block;
    }
    .carousel-caption {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.85));
      padding: 28px 12px 10px;
      color: #fff;
      font-size: 0.85rem;
      font-family: var(--serif);
      line-height: 1.4;
    }
    .carousel-ch {
      display: inline-block;
      font-size: 0.7rem;
      color: var(--gold);
      margin-right: 6px;
      font-family: var(--sans);
      letter-spacing: 0.06em;
    }
    .carousel-dots {
      text-align: center;
      padding-top: 12px;
    }
    .carousel-dot {
      display: inline-block;
      width: 7px; height: 7px;
      border-radius: 50%;
      background: rgba(255,255,255,0.25);
      margin: 0 4px;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
    }
    .carousel-dot.active {
      background: var(--gold);
      transform: scale(1.3);
    }
    @media (min-width: 600px) {
      .carousel-slide { flex: 0 0 280px; }
      .carousel-track { padding: 0 calc((100vw - 900px) / 2); gap: 18px; }
    }

    /* ─── Navigation ─── */
    .nav-bar {
      position: sticky; top: 0; z-index: 100;
      background: rgba(10,10,15,0.92);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--chapter-border);
      padding: 10px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      overflow-x: auto;
      font-family: var(--sans);
      font-size: 0.8rem;
    }
    .nav-bar .nav-title {
      color: var(--gold);
      font-weight: 700;
      white-space: nowrap;
      margin-right: 8px;
    }
    .nav-bar a {
      color: var(--text-secondary);
      text-decoration: none;
      white-space: nowrap;
      padding: 4px 10px;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .nav-bar a:hover {
      color: var(--accent);
      background: rgba(74,158,255,0.1);
    }

    /* ─── TOC ─── */
    .toc {
      max-width: 700px;
      margin: 60px auto 40px;
      padding: 0 20px;
    }
    .toc h3 {
      font-family: var(--sans);
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      color: var(--text-secondary);
      text-transform: uppercase;
      margin-bottom: 20px;
    }
    .toc-item {
      display: flex; align-items: center; gap: 16px;
      padding: 14px 18px;
      color: var(--text-primary);
      text-decoration: none;
      border-left: 2px solid var(--chapter-border);
      transition: all 0.25s;
      font-family: var(--sans);
      font-size: 0.95rem;
    }
    .toc-item:hover {
      border-color: var(--accent);
      background: rgba(74,158,255,0.04);
      padding-left: 24px;
    }
    .toc-num {
      font-size: 0.75rem;
      color: var(--accent-dim);
      font-weight: 700;
      min-width: 20px;
    }

    /* ─── Characters ─── */
    .characters {
      max-width: 700px;
      margin: 40px auto 60px;
      padding: 0 20px;
    }
    .characters h3 {
      font-family: var(--sans);
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      color: var(--text-secondary);
      margin-bottom: 20px;
    }
    .char-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
    }
    .char-card {
      background: var(--bg-card);
      border: 1px solid var(--chapter-border);
      border-radius: 8px;
      padding: 18px;
    }
    .char-name {
      font-family: var(--sans);
      font-weight: 700;
      font-size: 1rem;
      color: var(--gold);
      margin-bottom: 4px;
    }
    .char-meta {
      font-family: var(--sans);
      font-size: 0.75rem;
      color: var(--accent);
      margin-bottom: 8px;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .char-meta span {
      background: rgba(74,158,255,0.1);
      padding: 1px 8px;
      border-radius: 4px;
    }
    .char-appearance {
      font-size: 0.82rem;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-bottom: 6px;
      border-left: 2px solid var(--chapter-border);
      padding-left: 10px;
    }
    .char-desc {
      font-size: 0.85rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    /* ─── Divider ─── */
    .section-divider {
      width: 40px; height: 1px;
      background: var(--chapter-border);
      margin: 0 auto;
    }

    /* ─── Chapter ─── */
    .chapter {
      max-width: 700px;
      margin: 0 auto;
      padding: 80px 20px;
      border-top: 1px solid var(--chapter-border);
    }
    .chapter-header {
      text-align: center;
      margin-bottom: 48px;
    }
    .chapter-number {
      font-family: var(--sans);
      font-size: 0.7rem;
      letter-spacing: 0.25em;
      color: var(--accent-dim);
      display: block;
      margin-bottom: 8px;
    }
    .chapter-title {
      font-family: var(--serif);
      font-size: clamp(1.3rem, 3vw, 1.8rem);
      font-weight: 700;
      letter-spacing: 0.05em;
    }
    .chapter-image {
      margin: 0 -20px 40px;
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid var(--chapter-border);
    }
    .chapter-image img {
      width: 100%;
      height: auto;
      display: block;
      opacity: 0.92;
    }
    .chapter-body p {
      margin-bottom: 1.2em;
      text-indent: 1em;
      text-align: justify;
    }
    .chapter-body p:empty {
      display: none;
    }

    /* ─── Footer ─── */
    .footer {
      text-align: center;
      padding: 60px 20px;
      font-family: var(--sans);
      font-size: 0.75rem;
      color: var(--text-secondary);
      border-top: 1px solid var(--chapter-border);
    }

    /* ─── Reading mode toggle ─── */
    .mode-toggle {
      position: fixed; bottom: 20px; right: 20px; z-index: 200;
      background: var(--bg-card);
      border: 1px solid var(--chapter-border);
      color: var(--text-secondary);
      font-family: var(--sans);
      font-size: 0.75rem;
      padding: 8px 14px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .mode-toggle:hover {
      border-color: var(--accent);
      color: var(--accent);
    }



    /* ─── Light mode ─── */
    body.light {
      --bg-primary: #f5f0e8;
      --bg-secondary: #ebe5d9;
      --bg-card: #fff;
      --text-primary: #2a2a2a;
      --text-secondary: #6a6a6a;
      --chapter-border: #d5cfc3;
      --accent: #2563eb;
      --accent-dim: #6b9eff;
      --gold: #8a6d2b;
    }

    /* ─── Responsive ─── */
    @media (max-width: 600px) {
      body { font-size: 15px; }
      .chapter { padding: 50px 16px; }
    }

    /* ─── Scroll progress ─── */
    .scroll-progress {
      position: fixed; top: 0; left: 0; z-index: 200;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), var(--gold));
      width: 0%;
      transition: width 0.1s;
    }
  </style>
</head>
<body>
  <div class="scroll-progress" id="progress"></div>

  <header class="hero">
    <h1 class="hero-title">千年後の未来への旅: 時空の旅人たち</h1>
    <p class="hero-sub">GENERATED WITH LOCAL AI — LOCAL LLM + STABLE DIFFUSION</p>
    <div class="hero-line"></div>
  </header>

  <nav class="nav-bar">
    <span class="nav-title">目次</span>
    <a href="#chapter-1">第1章</a><a href="#chapter-2">第2章</a><a href="#chapter-3">第3章</a><a href="#chapter-4">第4章</a><a href="#chapter-5">第5章</a>
  </nav>

  <div class="toc">
    <h3>— 目次 —</h3>
        <a href="#chapter-1" class="toc-item"><span class="toc-num">1</span><span class="toc-label">時空の裂け目</span></a>
        <a href="#chapter-2" class="toc-item"><span class="toc-num">2</span><span class="toc-label">過去の囁き</span></a>
        <a href="#chapter-3" class="toc-item"><span class="toc-num">3</span><span class="toc-label">記憶の断片</span></a>
        <a href="#chapter-4" class="toc-item"><span class="toc-num">4</span><span class="toc-label">未来への帰還</span></a>
        <a href="#chapter-5" class="toc-item"><span class="toc-num">5</span><span class="toc-label">新たな旅の始まり</span></a>
  </div>

  <div class="characters">
    <h3>— 登場人物 —</h3>
    <div class="char-grid">
      <div class="char-card">
        <div class="char-name">時空の旅人</div>
        <div class="char-meta"><span>主人公</span><span>25歳</span></div>
        <div class="char-appearance">銀髪に紫の瞳を持つ少女。時空移動装置の残骸から生まれた機械的な装飾を身にまとっている。
常に重い旅行バッグを担ぎ、疲れた表情で歩き続けているが、目は決意に満ちている。</div>
        <div class="char-desc">冷静で思いやり深く、過去の記憶を失ったことで感情が不安定になりがち</div>
      </div>
      <div class="char-card">
        <div class="char-name">時空の守護者</div>
        <div class="char-meta"><span>サブキャラ</span><span>30歳</span></div>
        <div class="char-appearance">白いローブをまとった老人。体に刻まれた時計の模様が常に動いている。
静かな態度だが、目元には深い知識と経験が宿っている。</div>
        <div class="char-desc">知的で落ち着いており、旅人を導くための古代の知識を持つ</div>
      </div>
    </div>
  </div>

  <div class="section-divider"></div>

  <main>

    <section class="chapter" id="chapter-1">
      <div class="chapter-header">
        <span class="chapter-number">第1章</span>
        <h2 class="chapter-title">時空の裂け目</h2>
      </div>
      
      <div class="chapter-body">
        <p>第1章　時空の裂け目</p>

        <p>雷鳴が地を裂く。雨粒が暗い空から落ちる音は、彼女の鼓膜を震わせる。空気は湿って冷たく、体中の細胞が凍てつくように感じる。彼女の目が開かれる。視界はぼやけ、記憶が闇に沈む。手が震え、バッグの重さが増した。足元は古代の石畳。砕けたタイルの下から、何かが光っている。彼女は立ち上がり、その物に近づく。指でなぞると、冷たい金属の感触。刻まれた文字は風化し、読めない。しかし、その中から微かな振動が伝わってくる。彼女は息をのむ。この装置が、彼女を過去に引きずり込んだのか。</p>

        <p>石畳には苔が這い、風が吹き抜ける。土の香りと雨の金属臭が混ざり、鼻腔を刺激する。遠くで水が滴る音。彼女の足音が静かに響く。装置は円形で、表面に幾何学模様。一部が剥がれ、中から青白い光が漏れる。彼女は指でそっと触れる。振動が手のひらを駆け、体内に電気信号のようなものが駆け抜ける。目が痛む。周りの景色がゆっくりと歪み始める。木々が幾筋もの光に分かれ、空の色が変わる。過去への裂け目が広がる。彼女はよろめき、バッグを支える。手が血をにじませる。傷はないが、皮膚が引き裂かれるような痛み。装置の光が彼女の目に焼きつく。過去の記憶が、断片的に蘇る。幼い頃の笑顔。遠い街の香り。しかし、それは本物なのか、装置が再現した幻なのか。彼女の手が装置のスイッチを触れる。光が強まり、音が響く。世界が再び揺れる。彼女は目を閉じる。耳に残るのは、雨の音と、装置の低い唸り。その先に何があるのか、彼女は知らない。ただ、手を離すことはできない。</p>
      </div>
    </section>
    <section class="chapter" id="chapter-2">
      <div class="chapter-header">
        <span class="chapter-number">第2章</span>
        <h2 class="chapter-title">過去の囁き</h2>
      </div>
      
      <div class="chapter-body">
        <p>第2章　過去の囁き</p>

        <p>夜は紫がかった雲に覆われ、雨粒がネオンの残骸を叩く。空気は冷たく、金属の腐食臭が鼻を刺す。アスファルトの亀裂から青白い光が漏れ、雨に反射して幾何学的な模様を描く。彼女の旅行バッグは肩から下がり、鈍い金属音を立てる。足元の廃墟は苔と錆で覆われ、高層ビルの残骸が風に揺れる。彼女の足音は空虚な空間に吸い込まれるが、遠くで何かが動く気配がする。銀髪が雨に濡れ、紫の瞳が廃墟をゆっくりと巡らす。肩が小刻みに震え、足取りは重い。白いローブが風に翻る。彼の体に刻まれた時計の模様が、雨粒ごとに動く。彼は肩を落とし、静かに歩み寄る。目元には深い知識の影が宿り、口元には鋭い光が宿る。彼は指先で壁をなぞる。そこは古代の文字で覆われていたが、雨で消えかかっている。旅人は足を止め、指で触れる。ザラザラした石の感触。文字は『記憶の断片』と読める。ローブの端が彼女の手に触れる。静かな音が、雨と機械の振動に紛れる。彼は彼女に近づき、唇を閉じる。目元に微かな笑み。その先には、さらに深い廃墟が広がる。</p>
      </div>
    </section>
    <section class="chapter" id="chapter-3">
      <div class="chapter-header">
        <span class="chapter-number">第3章</span>
        <h2 class="chapter-title">記憶の断片</h2>
      </div>
      
      <div class="chapter-body">
        <p>第3章　記憶の断片  </p>

        <p>鉄の冷たさが皮膚に沁みる空間。蛍光灯の残光が壁に浮かぶ断片的な影を描き、壁面の亀裂から漏れる月光が青白く床を濡らす。空気はほこりで濁り、静電気が髪を逆立てる。旅人は床に膝をつき、両手で包んだ金属片を握りしめている。その表面には微細な溝が刻まれ、微かな振動が体中に伝わる。  </p>

        <p>光の閃き。画面に浮かぶのは、砂漠の果てにたたずむ巨大な塔。その頂上に浮かぶ星のような装置。次に、幼い自分が泣きながら手を伸ばす母の顔。しかし、その記憶は数秒で消え、代わりに鉄の床にこぼれた血の痕が赤く光る。  </p>

        <p>「この装置を起動させれば、時間の亀裂を封じられる」  </p>
        <p>守護者の声は静かだが、背後の時計模様が一斉に動き、部屋の奥から光の帯が伸びる。彼は旅人を振り返らずに言った。  </p>
        <p>「覚えておるか。過去の失敗が未来を滅ぼす」  </p>

        <p>旅人の指先が金属片を触れさせる。刺すような痛み。画面に浮かぶのは、戦場の光景。銃火の音。自分が倒れ、血を流す映像。だが、その直後、星空の下で笑う自分が現れる。  </p>

        <p>彼女は息を止めた。胸の奥で何かが折れる。目元に涙が浮かび、指先で拭おうとした時、守護者が手を差し伸べる。しかし、その手は冷たく、触れることはなかった。  </p>

        <p>「なぜ、あなたが？」  </p>
        <p>画面に突然、未来の都市が現れる。崩壊する高層ビル。無数の人々が逃げる。その中で、自分が微笑んでいる。  </p>

        <p>「任務を知っていながら、なぜ逃げなかった？」  </p>
        <p>守護者の声はさらに低く。  </p>

        <p>旅人の目から涙が流れる。しかし、その涙は床に落ちる前に光の粒子に変わり、天井へと昇っていく。  </p>

        <p>空間が揺れる。壁の亀裂が広がり、星の装置が光を失う。だが、金属片の振動は強まる。  </p>

        <p>「覚悟を決めて」  </p>
        <p>旅人は歯を食い縛り、指先で金属片を強く握りしめる。  </p>

        <p>（続く）</p>
      </div>
    </section>
    <section class="chapter" id="chapter-4">
      <div class="chapter-header">
        <span class="chapter-number">第4章</span>
        <h2 class="chapter-title">未来への帰還</h2>
      </div>
      
      <div class="chapter-body">
        <p>第4章　未来への帰還</p>

        <p>雨は窓ガラスを叩き、人工照明の薄明かりを波打たせる。湿った空気が金属の冷たさを包み込み、装置のコアから立ち昇る白い蒸気が暗闇に溶け込む。時計の模様が体中に刻まれた守護者は、膝を立てて座り、床に散らばった歪んだ時空の断片を指でなぞった。旅人はバッグを床に置き、両手で装置のスイッチを握りしめる。指の関節が震える。雨の匂いが窓から漏れ、古代文明の残骸が持つ錆の香りと混じる。</p>

        <p>装置は低い唸りを上げ、青白い光がコントロールパネルを駆け巡る。守護者の目は暗闇に反射し、瞬き一つせずに旅人を見つめる。彼の声は紙をすり合わせるような音で、  </p>
        <p>「時間は裂ける。しかし、あなたを運ぶ」  </p>
        <p>という言葉だけが残る。旅人は息を止め、スイッチを押し込む。光が一気に膨張し、空間を歪ませる。</p>

        <p>蒸気が天井へ昇り、雨音が止む。空気が震え、守護者のローブが風に揺れる。彼は一歩前に出し、装置の扉に手をかけた。その指先に触れた金属は、触れるたびに熱くなる。旅人は彼の背中を目で追う。守護者は微笑を浮かべず、静かに口を開く。  </p>
        <p>「未来はもう、ここにある」  </p>

        <p>装置の扉が開き、光が旅人を包む。守護者の影がゆっくりと消え、代わりに空間に渦巻く光の糸が残り、天井へと消える。旅人は手を伸ばし、空気の残滓を掬おうとする。しかし、その手は空を切り、雨粒が窓に降り注ぐ。遠くで、バイクのエンジンが唸る。</p>
      </div>
    </section>
    <section class="chapter" id="chapter-5">
      <div class="chapter-header">
        <span class="chapter-number">第5章</span>
        <h2 class="chapter-title">新たな旅の始まり</h2>
      </div>
      
      <div class="chapter-body">
        <p>第5章　新たな旅の始まり</p>

        <p>冷たい空気が肌を刺す。紫の瞳が瞬き、銀髪が乱れた。バッグの金属枠が、過去の温度と未来の冷たさを計測するように震えている。路地の奥から漂うオゾンと古代金属の臭いが、彼女の鼻腔をくすぐる。空の向こうで、何かが割れた音を立てた。  </p>

        <p>彼女は立ち止まり、空を見上げた。雲はなく、空は青く澄んでいたが、太陽の光が鋭く、目元に灼ける。バッグのひもが引っ張られ、彼女の肩が少し前傾する。その先で、白いローブの老人が片手を上げた。その手の甲に刻まれた時計の模様が、微かに光を放ちながら消えゆく。  </p>

        <p>地面に足を下ろす。冷たさが足裏を伝わり、血管を震わせる。空気は未来のものだ。過去では感じなかった、微かな電流のような振動が体中を駆け巡る。彼女の指先に、バッグからはみ出した金属片が触れる。それが、旅を続けるための鍵だと、何かが囁いている。  </p>

        <p>路地を進む。ビルの壁は透明で、内側から発光している。光は青と緑が混ざり、昼夜の境界を消し去っている。歩くたびに、足元の地面が微かに隆起する。まるで大地が息をしているようだ。空気中に漂う粉塵が、陽光を反射してキラキラと舞う。  </p>

        <p>遠く、空の上に何かが浮かんでいる。大きな円形の構造物で、表面に無数の窓が並ぶ。光が乱反射し、虹のように屈折している。その向こうで、何かが動く。影が通り過ぎるたびに、音が聞こえる。金属を擦る音。声ではない、風の音。  </p>

        <p>彼女の手が、バッグから一枚の紙を取り出した。それは透明で、書かれた文字が透けて見える。古代の言語。守護者が遺したものだ。彼女はそれを眺め、唇を引き結んだ。その紙には、新たな目的地の座標が記されていた。  </p>

        <p>足を進める。空気は未来のものだが、心は過去を求めて震えている。バッグの重さが増し、肩に食い込む。しかし、その重さが、彼女を突き動かす。  </p>

        <p>新たな道が開ける。その先には、緑が広がっていた。だが、木々は機械の一部のように輝き、葉は光を吸収する。風が吹くたびに、葉が音を立てて振動する。  </p>

        <p>彼女の足が、その森の縁に立つ。空の円形構造物が、さらに近づいている。光が彼女を包み込む。すると、声が聞こえた。  </p>

        <p>「また、旅を続けますか？」  </p>

        <p>誰かが、そう問うた。だが、声は風に消え、彼女の耳には届かない。  </p>

        <p>彼女はバッグを肩にかけ直し、一歩を踏み出した。足元の地面が、微かに光る。  </p>

        <p>その先で、何かが待っている。  </p>

        <p>新たな目的地は、まだ見えない。  </p>

        <p>だが、彼女は歩き続ける。  </p>

        <p>空は青く、未来は続いている。  </p>

        <p>彼女の影が、遠ざかる。</p>
      </div>
    </section>
  </main>

  <footer class="footer">
    <p>千年後の未来への旅: 時空の旅人たち</p>
    <p>Generated locally with Local LLM + Stable Diffusion</p>
  </footer>


  </button>

  <button class="mode-toggle" onclick="toggleMode()">🌗 表示切替</button>

  <script>
    // Reading mode
    function toggleMode() {
      document.body.classList.toggle('light');
    }
    if (localStorage.getItem('mode') === 'light') document.body.classList.add('light');

    // Scroll progress
    window.addEventListener('scroll', () => {
      const h = document.documentElement;
      const pct = (h.scrollTop / (h.scrollHeight - h.clientHeight)) * 100;
      document.getElementById('progress').style.width = pct + '%';
    });

    // === TTS (Web Speech API) ===

    document.querySelectorAll('.chapter').forEach((sec, i) => {
      const b = sec.querySelector('.chapter-body');
      const t = sec.querySelector('.chapter-title');
        title: t ? t.textContent : ('Ch.' + (i+1)),
        text: b.textContent.trim(), el: sec
      });
    });

      if (!synth) { alert('Speech not supported'); return; }
      const sy = window.scrollY + window.innerHeight / 3;
      let cl = 0;
    }

      synth.cancel();
      ch.el.scrollIntoView({ behavior: 'smooth', block: 'start' });

      // Split by Japanese sentence endings for reliable playback
      const sents = ch.text.match(/[^。！？
]+[。！？]?/g) || [ch.text];
      let si = 0;

      function next() {
        if (si >= sents.length) {
          return;
        }
        const vs = synth.getVoices();
        const jv = vs.find(v => v.lang && v.lang.startsWith('ja'));
        if (jv) u.voice = jv;
        u.onend = () => { si++; next(); };
        u.onerror = () => { si++; next(); };
        synth.speak(u);
      }
      next();
    }

      } else {
      }
    }

    }

      document.getElementById('ttsSpeedVal').textContent = v + 'x';
    }
    if (synth) synth.onvoiceschanged = () => synth.getVoices();

    /* ─── Carousel ─── */
    (function() {
      const track = document.getElementById('carouselTrack');
      if (!track) return;
      const dots = track.parentElement.querySelectorAll('.carousel-dot');
      const slides = track.querySelectorAll('.carousel-slide');
      if (slides.length < 1) return;
      function updateDots() {
        const sw = slides[0].offsetWidth + 14;
        const idx = Math.round(track.scrollLeft / sw);
        dots.forEach((d, i) => d.classList.toggle('active', i === idx));
      }
      track.addEventListener('scroll', updateDots, { passive: true });
      dots.forEach(d => d.addEventListener('click', () => {
        const sw = slides[0].offsetWidth + 14;
        track.scrollTo({ left: parseInt(d.dataset.idx) * sw, behavior: 'smooth' });
      }));
      let paused = false, timer = setInterval(() => {
        if (paused) return;
        const sw = slides[0].offsetWidth + 14;
        const mx = track.scrollWidth - track.clientWidth;
        const nx = track.scrollLeft + sw;
        track.scrollTo({ left: nx > mx ? 0 : nx, behavior: 'smooth' });
      }, 4000);
      track.addEventListener('touchstart', () => { paused = true; clearInterval(timer); }, { passive: true });
      track.addEventListener('touchend', () => {
        paused = false;
        timer = setInterval(() => {
          if (paused) return;
          const sw = slides[0].offsetWidth + 14;
          const mx = track.scrollWidth - track.clientWidth;
          const nx = track.scrollLeft + sw;
          track.scrollTo({ left: nx > mx ? 0 : nx, behavior: 'smooth' });
        }, 4000);
      }, { passive: true });
    })();

  </script>
</body>
</html>